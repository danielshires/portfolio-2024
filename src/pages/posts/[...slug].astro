---
import Layout from '../../layouts/Layout.astro'
import { getPostBySlug, getAllPosts } from '../../lib/sanity'
import { urlFor } from '../../lib/sanity'
import type { Post } from '../../lib/sanity'
import { PortableText } from '@portabletext/react'
import PageTransition from '../../components/Transitions/PageTransition.astro'

export async function getStaticPaths() {
  const posts = await getAllPosts()
  return posts.map((post: Post) => ({
    params: { slug: post.slug.current },
    props: { post },
  }))
}

const { post } = Astro.props
---

<Layout pageTitle={post.title} pageDescription={post.description || ''}>
  <PageTransition>
    <article class='mt-24 py-12'>
      {
        post.mainImage && (
          <div class='mb-8 overflow-hidden rounded-lg'>
            <img
              src={urlFor(post.mainImage).width(1200).url()}
              alt={post.title}
              class='w-full h-96 object-cover'
            />
          </div>
        )
      }

      <header class='mb-8'>
        <h1 class='text-4xl font-bold mb-4'>{post.title}</h1>
        <div class='flex items-center gap-2 text-gray-600'>
          <time datetime={post.publishedAt}>
            {
              new Date(post.publishedAt).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })
            }
          </time>
          {post.author && <span>by {post.author}</span>}
        </div>
        {
          post.tags && post.tags.length > 0 && (
            <div class='mt-4 flex gap-2'>
              {post.tags.map((tag: string) => (
                <span class='px-3 py-1 bg-gray-100 rounded-full text-sm text-gray-700'>{tag}</span>
              ))}
            </div>
          )
        }
      </header>

      <div class='prose prose-lg max-w-none'>
        <PortableText value={post.body} />
      </div>
    </article>
  </PageTransition>
</Layout>
