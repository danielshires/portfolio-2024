---
import Layout from '../../layouts/Layout.astro'
import { getPostBySlug, getAllPosts } from '../../lib/sanity'
import { urlFor } from '../../lib/sanity'
import Image from 'astro/components/Image.astro'
import PageTransition from '../../components/Transitions/PageTransition.astro'

export async function getStaticPaths() {
  const posts = await getAllPosts()
  return posts.map((post) => ({
    params: { slug: post.slug.current },
    props: { post },
  }))
}

const { post } = Astro.props
---

<Layout pageTitle={post.title} pageDescription={post.description || post.title}>
  <PageTransition>
    <article class='prose prose-lg max-w-none mt-32'>
      <header class='mb-8'>
        <h1 class='text-4xl font-bold mb-4'>{post.title}</h1>
        {
          post.description && (
            <p class='text-lg text-zinc-600 dark:text-zinc-400'>{post.description}</p>
          )
        }
        <div class='flex items-center gap-2 text-zinc-600 dark:text-zinc-400'>
          <time datetime={post.publishedAt}>
            {
              new Date(post.publishedAt).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })
            }
          </time>
          {post.category && <span>Â· {post.category}</span>}
        </div>
      </header>

      {
        post.mainImage && (
          <div class='mb-8'>
            <Image
              src={urlFor(post.mainImage).width(1200).url()}
              alt={post.title}
              width={1200}
              height={600}
              class='w-full rounded-lg'
            />
          </div>
        )
      }

      {
        post.body ? (
          <div class='prose prose-lg max-w-none' set:html={post.body} />
        ) : (
          <div class='prose prose-lg max-w-none'>
            <p class='text-zinc-600 dark:text-zinc-400 italic'>Content coming soon...</p>
          </div>
        )
      }
    </article>
  </PageTransition>
</Layout>
