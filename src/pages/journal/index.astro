---
import Layout from '../../layouts/Layout.astro'
import { getAllPosts } from '../../lib/sanity'
import FilterPostsReact from '../../components/forms/filters/FilterPostsReact.tsx'
import SimpleHero from '../../components/content/featured/SimpleHero.astro'

const posts = await getAllPosts()

// Extract unique categories and tags from posts
const categories = Array.from(
  new Set(
    posts
      .map((post) => (typeof post.category === 'string' ? post.category : undefined))
      .filter((c): c is string => Boolean(c))
  )
)
const tags = Array.from(new Set(posts.flatMap((post) => post.tags || [])))
---

<Layout
  pageTitle='Journal'
  pageDescription='Notes, stories, and reflections on design, development, and the digital world.'>
  <main class='min-h-screen'>
    <!-- Hero Section -->
    <SimpleHero
      introText={{
        first: 'Journal',
        second: 'Notes, stories, and reflections on design, development, and the digital world.',
      }}
    />

    <!-- Filters and Posts Grid -->
    <section class='pb-16'>
      <div class='container mx-auto'>
        <FilterPostsReact client:only='react' posts={posts} categories={categories} tags={tags} />
      </div>
    </section>
  </main>
</Layout>
