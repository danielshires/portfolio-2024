---
import Layout from '../../layouts/Layout.astro'
import { getAllPosts } from '../../lib/sanity'
import FilterPostsReact from '../../components/FilterPostsReact.tsx'
import Text from '../../components/Text/Text.tsx'

const posts = await getAllPosts()

// Extract unique categories and tags from posts
const categories = Array.from(
  new Set(
    posts
      .map((post) => (typeof post.category === 'string' ? post.category : undefined))
      .filter((c): c is string => Boolean(c))
  )
)
const tags = Array.from(new Set(posts.flatMap((post) => post.tags || [])))
---

<Layout
  pageTitle='Journal'
  pageDescription='Notes, stories, and reflections on design, development, and the digital world.'>
  <main class='min-h-screen pt-20 pb-16'>
    <!-- Header -->
    <section class='py-16 md:py-24'>
      <div class='container mx-auto'>
        <div class='text-center space-y-6'>
          <Text variant='h1' size='5xl' className='font-bold'>Journal</Text>
          <Text variant='body' size='lg' color='muted'>
            Notes, stories, and reflections on design, development, and the digital world.
          </Text>
        </div>
      </div>
    </section>

    <!-- Filters and Posts Grid -->
    <section class='pb-16'>
      <div class='container mx-auto'>
        <FilterPostsReact client:only='react' posts={posts} categories={categories} tags={tags} />
      </div>
    </section>
  </main>
</Layout>
